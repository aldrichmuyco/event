{% extends 'base.html' %}
{% load static mathfilters %}

{% block title %} Overall Rating {% endblock %}

{% block style %} 
    <style>
        body {
            background-color: rgb(255, 255, 255) !important; 
        }
        .signature  {
            border: none;
            display: block;
            border-top: 1px solid rgb(102, 102, 102);
            width: 300px;
        }
        .signature-note  {
            border: none;
            display: block;
            border-bottom: 1px solid rgb(102, 102, 102);
            width: 300px;
        }
        .table-overall {
            font-size: 14px;
        }
        .table.dataTable.no-footer,
        .table.dataTable thead th {
            border-bottom: none;
        }
    </style>
{% endblock %}

{% block content %} 

    {% block navbar %} 
        {% include 'includes/navbar.html' %}  
    {% endblock %}
    
    <div class="container-fluid pl-4 pr-4">
        {% block section %}
            <section class="mt-5">
                <h1 class="text-secondary">{{ details.title }} ({{groups.0.detail.name}})</h1> 
                <p class="text-secondary">Hospital Week 2019</p> 
            </section>
        {% endblock %}
        
        <hr>

        {% block article %} 
            <article>
                <div class="row">
                    <div class="col-md-12">
                        {% if groups %} 
                            {% for group in groups %}
                                <div class="card bg-none border-0"> 
                                    {% for category in group.categories %}
                                        <!-- <div class="table-responsive"> -->
                                            <h6 class="mt-3">{{category.detail.name}} ({{category.detail.weight}}%)</h6>
                                            <table class="table table-striped table-hover table-bordered table-overall dt-responsive nowrap" id="table-overall-{{forloop.counter}}" style="width:100%">
                                                <thead class="text-center">
                                                    <tr>
                                                        <th rowspan=2 width="10px">No</th>
                                                        <th rowspan=2>Participant</th>
                                                        {% for criteria_row in categories.0.criteria %}
                                                            <th colspan="{{judges|length}}">{{criteria_row.name}} <br> ({{criteria_row.weight}})%</th>
                                                        {% endfor %}
                                                        <th colspan="{{judges|length|add:'3'}}" width="auto">Total <br> (100%)</th>
                                                    </tr>
                                                    <tr>
                                                        {% for criteria_row in categories.0.criteria %}
                                                            {% for judge in judges %}
                                                                <th> J{{forloop.counter}} </th>
                                                            {% endfor %}
                                                            <!-- <th>Avg</th> -->
                                                        {% endfor %}
                                                        {% for judge in judges %}
                                                            <th> J{{forloop.counter}} </th>
                                                        {% endfor %}
                                                        <th> Avg </th>
                                                        <th> Deduction </th>
                                                        <th> Score </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for participant in category.participants %}
                                                        <tr>
                                                            <td> {{forloop.counter}} </td>
                                                            <td> {{participant.detail.name}} </td>
                                                            
                                                            {% for rating_row in participant.rating %}
                                                                {% for score_row in rating_row.scores %}
                                                                    <td> {{score_row|default:"---"}} </td>
                                                                {% endfor %}
                                                                <!-- <td>{{rating_row.pt_average|floatformat:3}}</td> -->
                                                            {% endfor %}

                                                            {% for totals_row in participant.totals %}
                                                                <td> {{totals_row}} </td>
                                                            {% endfor %}

                                                            <td> {{participant.participant_gt|floatformat:3}} </td>
                                                            <td> {{participant.detail.deduction}} </td>
                                                            <th> {{participant.participant_gt|sub:participant.detail.deduction|floatformat:3}} </th>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        <!-- </div> -->                  
                                    {% endfor %}
                                </div> 
                            {% endfor %}   

                            <!-- Grand Total -->
                            <!-- {% for group in groups %}
                                <div class="card bg-none border-0 mt-4 mb-0">
                                    <h6 class="mt-3">Overall</h6>
                                    <table class="table table-bordered table-striped m-0" width="100%" id="table-grand-total">
                                        <thead class="text-center">
                                            <tr>
                                                <th rowspan="2">No</th>
                                                <th rowspan="2">Candidate</th>
                                                {% for category in group.categories %}
                                                    <th colspan=2>{{category.detail.name}}</th>
                                                {% endfor %}
                                                <th rowspan="2">Grand Total <br> (100%)</th>
                                            </tr>
                                            <tr>
                                                {% for category in group.categories %}
                                                    <th>Score</th>
                                                    <th>Weight ({{category.detail.weight}} %)</th>
                                                {% endfor %}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for overall_row in group.overall %}
                                                <tr>
                                                    <td>{{overall_row.detail.order}}</td>
                                                    <td>{{overall_row.detail.name}}</td>
                                                    {% for score_row in overall_row.scores %}
                                                        <td>{{score_row.score}}</td>
                                                        <td>{{score_row.percentage}}</td>
                                                    {% endfor %}
                                                    <td class="text-success"> <b> {{overall_row.total}}</b></td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% endfor %}     -->

                        {% endif %}
                    </div>
                </div>
            </article>
        {% endblock %}

        {% block footer %}
            <footer class="mt-5 mb-5">
                <!-- Signarure Foot -->
                <p>Confirmed: </p>
                {% for judge_row in judges %}
                    <input type="text" class="signature bg-none mt-5 ml-2 text-dark" value="{{judge_row.user.first_name}} {{judge_row.user.last_name}}" disabled>
                {% endfor %}    

                <p class="mt-5"> Noted: </p>
                <input type="text" class="signature-note bg-none mt-4">
            </footer>
        {% endblock %}
        
    </div>
    
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function () {
            $('#table-overall-1').DataTable({
                resposive: true,
                searching: false,
                paging: false,
                bInfo: false,
            });
            $('#table-overall-2').DataTable({
                resposive: true,
                searching: false,
                paging: false,
                bInfo: false,
            });
            $('#table-grand-total').DataTable({
                resposive: true,
                searching: false,
                paging: false,
                bInfo: false,
            });
        });
        
    </script>
{% endblock %}